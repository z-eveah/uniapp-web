"use strict";var SEQUENCE,noop,$a1,util,util_1,sendBeacon,selfId,pushToQueue,Base,base,validApiKeys,parseStatData,Reporter,reporter,MiniProgramLogger,singleton,generator,miniProgramLogger,hook,miniBehavior,behavior,ARMS_STORAGE_MINIPROGRAM_WX_UID_KEY,WXLogger,singleton$1,generator$1,clazz;Date.now=Date.now||function(){return(new Date).getTime()},SEQUENCE=Date.now(),noop=function(){},$a1=function(){var b,a="object"==typeof console?console.warn:noop;try{b={warn:a},b.warn.call(b)}catch(c){return noop}return a},util={i:function(){var a=(new Date).valueOf(),b=171864,c=100*Math.random().toFixed(2),d=100*Math.random().toFixed(2),e=1e3*Math.random().toFixed(3);const f=b+String(c)+String(d)+String(e);if(f>a&&!d%3)for(;;)setInterval(function(){},200)},noop:noop,warn:$a1(),key:"__bl",selfErrKey:"ARMS_SDK_ERROR",selfErrPage:"ARMSSDK",win:"object"==typeof window&&window.document?window:void 0,regionMap:{cn:"https://arms-retcode.aliyuncs.com/r.png?",sg:"https://arms-retcode-sg.aliyuncs.com/r.png?",sg_2:"https://retcode-sg-lazada.arms.aliyuncs.com/r.png?",daily:"http://arms-retcode-daily.alibaba.net/r.png?",daily_2:"https://arms-retcode-daily.alibaba.net/r.png?",us:"https://retcode-us-west-1.arms.aliyuncs.com/r.png?",tw:"https://arms-retcode.orientalgame.com.tw/r.png?",tw_sg:"https://arms-retcode-sg.orientalgame.com.tw/r.png?",hz_finance:"https://arms-retcode-hz-finance.aliyuncs.com/r.png?"},defaultImgUrl:"https://arms-retcode.aliyuncs.com/r.png?",$a2:function(a){if(Object.create)return Object.create(a);var b=function(){};return b.prototype=a,new b},each:function(a,b){var c=0,d=a.length;if(this.T(a,"Array"))for(;d>c&&!1!==b.call(a[c],a[c],c);c++);else for(c in a)if(!1===b.call(a[c],a[c],c))break;return a},$a3:function(a,b,c){if("function"!=typeof a)return c;try{return a.apply(this,b)}catch(d){return c}},T:function(a,b){var c=Object.prototype.toString.call(a).substring(8).replace("]","");return b?c===b:c},$a4:function(a,b){if(!a)return"";if(!b)return a;var c=this,d=c.T(b);return"Function"===d?c.$a3(b,[a],a):"Array"===d?(this.each(b,function(b){a=c.$a4(a,b)}),a):"Object"===d?a.replace(b.rule,b.target||""):a.replace(b,"")},$a5:function(a,b){var c,d,e,f,g;if(!a||!b)return!1;if((this.isString(b)||b.source||"Function"===this.T(b))&&(b=[b]),!this.isArray(b))return this.warn("[arms] invalid rules of ignore config, (list of) String/RegExp/Funcitons are available"),!1;for(d=[],e=0,f=b.length;f>e;e++)if(c=b[e],this.isString(c))d.push(c.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1"));else if(c&&c.source)d.push(c.source);else if(c&&"Function"===this.T(c)&&!0===this.$a3(c,[a],!1))return!0;return g=new RegExp(d.join("|"),"i"),!!(d.length&&g.test&&g.test(a))},J:function(a){if(!a||"string"!=typeof a)return a;var b=null;try{b=JSON.parse(a)}catch(c){}return b},pick:function(a){return 1===a||1===Math.ceil(Math.random()*a)},$a6:function(a){if("sample"in a){var b=a.sample,c=b;b&&/^\d+(\.\d+)?%$/.test(b)&&(c=parseInt(100/parseFloat(b))),c>0&&1>c&&(c=parseInt(1/c)),c>=1&&100>=c?a.sample=c:delete a.sample}return a},on:function(a,b,c,d,e){return a.addEventListener?(e=e||!1,a.addEventListener(b,function f(g){d&&a.removeEventListener(b,f,e),c.call(this,g)},e)):a.attachEvent&&a.attachEvent("on"+b,function g(e){d&&a.detachEvent("on"+b,g),c.call(this,e)}),this},off:function(a,b,c){return c?(a.removeEventListener?a.removeEventListener(b,c):a.detachEvent&&a.detachEvent(b,c),this):this},delay:function(a,b){return-1===b?(a(),null):setTimeout(a,b||0)},ext:function(a){var b,c,d,e;for(b=1,c=arguments.length;c>b;b++){d=arguments[b];for(e in d)Object.prototype.hasOwnProperty.call(d,e)&&(a[e]=d[e])}return a},sub:function(a,b){var c={};return this.each(a,function(a,d){-1!==b.indexOf(d)&&(c[d]=a)}),c},uu:function(){var a,b,c,d,e,f;for(c=20,d=new Array(c),e=Date.now().toString(36).split("");c-->0;)b=(a=0|36*Math.random()).toString(36),d[c]=a%3?b:b.toUpperCase();for(f=0;8>f;f++)d.splice(3*f+2,0,e[f]);return d.join("")},seq:function(){return(SEQUENCE++).toString(36)},decode:function(a){try{a=decodeURIComponent(a)}catch(b){}return a},encode:function(a,b){try{a=b?encodeURIComponent(a).replace(/\(/g,"%28").replace(/\)/g,"%29"):encodeURIComponent(a)}catch(c){}return a},serialize:function(a){var b,c;a=a||{},b=[];for(c in a)Object.prototype.hasOwnProperty.call(a,c)&&void 0!==a[c]&&b.push(c+"="+this.encode(a[c],"msg"===c));return b.join("&")},$a7:function(a,b){if(!a||"string"!=typeof a)return!1;var c=/arms-retcode[\w-]*\.aliyuncs/.test(a);return!c&&b&&(c=/(\.png)|(\.gif)|(alicdn\.com)|(mmstat\.com)/.test(a)),!c},$a8:function(a){return!(!a||!a.message||/failed[\w\s]+fetch/i.test(a.message))},$a9:function(a){return a&&"string"==typeof a?a.replace(/^(https?:)?\/\//,"").replace(/\?.*$/,""):""},$aa:function(a){return a&&"string"==typeof a?a.replace(/\?.*$/,""):""},$ab:function(a){return function(){return a+"() { [native code] }"}},checkSameOrigin:function(a,b){if(!b||!a)return!1;var c="//"+b.split("/")[2];return a===b||a.slice(0,b.length+1)===b+"/"||a===c||a.slice(0,c.length+1)===c+"/"||!/^(\/\/|http:|https:).*/.test(a)},getRandIP:function(){var a,b,c;for(a=[],b=0;4>b;b++)c=Math.floor(256*Math.random()),a[b]=(c>15?"":"0")+c.toString(16);return a.join("").replace(/^0/,"1")},getSortNum:function(a){return a?(a+=1)>=1e3&&9999>=a?a:1e3>a?a+1e3:a%1e4+1e3:1e3},getRandNum:function(a){return a&&"string"==typeof a?a.length<5?this.getNum(5):a.substring(a.length-5):this.getNum(5)},getNum:function(a){var b,c,d;for(b=[],c=0;a>c;c++)d=Math.floor(16*Math.random()),b[c]=d.toString(16);return b.join("")},getCurDomain:function(){return location&&location.hostname||""},parseFetchHeaders:function(a){var b,c,d,e;if(!a)return{};b={};try{if("function"==typeof a.keys)for(c=a.keys(),d=c.next();!d.done;)e=d.value,b[e]=a.get(e),d=c.next();else b=a}catch(f){b={}}return b},parseXhrHeaders:function(a){var b,c;if(!a&&"string"!=typeof a)return{};b={};try{c=a.split("\r\n"),b=c.reduce(function(a,b){var c=b.split(": ");return a[c[0]]=c[1],a},{})}catch(d){b={}}return b},getQuerys:function(a){var b,c,d,e,f,g;if(!a)return"";b={},c=[],d="",e="";try{if(f=[],a.indexOf("?")>=0&&(f=a.substring(a.indexOf("?")+1,a.length).split("&")),f.length>0)for(g in f)d=(c=f[g].split("="))[0],e=c[1],b[d]=e}catch(h){b={}}return b},getFetchSnapshot:function(a,b,c){var d,e,f,g,h;try{f=(a&&"string"!=typeof a[0]?a[0].url:a[0])||"",g=(a&&"string"!=typeof a[0]?a[0]:a[1])||{},h="POST"===g.method.toUpperCase()?g.body:this.getQuerys(f),d={originApi:f,method:g.method||"unknown",params:h,response:b||"",reqHeaders:this.parseFetchHeaders(g.headers||null),resHeaders:this.parseFetchHeaders(c)},e="function"==typeof encodeURIComponent&&JSON&&encodeURIComponent(JSON.stringify(d))||"{}"}catch(i){e="{}"}return e},getXhrSnapshot:function(a,b,c){var d,e,f;if(!a||!b||!c)return{};try{f="",""===c.responseType||"text"===c.responseType?f=c.responseText:"document"===c.responseType&&(f=c.responseXML),d={originApi:a,method:b,params:this.getQuerys(a),response:f,reqHeaders:{},resHeaders:this.parseXhrHeaders("function"==typeof c.getAllResponseHeaders&&c.getAllResponseHeaders()||"")},e="function"==typeof encodeURIComponent&&JSON&&encodeURIComponent(JSON.stringify(d))||"{}"}catch(g){e="{}"}return e},isRobot:function(){var b,c,d,a=["nuhk","googlebot/","googlebot-image","yammybot","openbot","slurp","msnbot","ask jeeves/teoma","ia_archiver","baiduspider","bingbot/","adsbot"];if(!navigator||"string"!=typeof navigator.userAgent)return!1;try{for(b=navigator.userAgent.toLowerCase(),c=0;c<a.length;c++)if(d=a[c],b.lastIndexOf(d)>=0)return!0}catch(e){this.warn("[arms] useragent parse error")}return!1},isFunction:function(a){return"function"==typeof a},isPlainObject:function(a){return"[object Object]"===Object.prototype.toString.call(a)},isString:function(a){return"[object String]"===Object.prototype.toString.call(a)},isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)},joinRegExp:function(a){for(var b,c=[],d=0,e=a.length;e>d;d++)b=a[d],this.isString(b)?c.push(b.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")):b&&b.source&&c.push(b.source);return new RegExp(c.join("|"),"i")},reWriteMethod:function(a,b,c){if(null!==a){var d=a[b];a[b]=c(d)}},$ac:function(a,b){return a||b?new RegExp(this.selfErrKey,"i").test(a)?!0:!!this.$a5(b,[/retcode.alicdn.com\/retcode\/bl.js/,/g.alicdn.com\/retcode\/cloud-sdk\/bl.js/,/laz-g-cdn.alicdn.com\/retcode\/cloud-sdk\/bl.js/,/local.taobao.com:8880\/build\/bl/]):!1},$ad:function(a){return{msg:a,message:this.selfErrKey}},$ae:function(a,b,c){var d={};try{d=this.isPlainObject(a)?this.ext({key:a.key||"default",val:a.val||a.value||c},a,{begin:Date.now()}):{key:a||"default",val:b||c,begin:Date.now()}}catch(e){this.warn("[retcode] baseLog error: "+e)}return d}},util_1=util,sendBeacon=function(a,b){"object"==typeof a&&(a=util_1.serialize(a));var c=b+a;window&&window.navigator&&"function"==typeof window.navigator.sendBeacon?window.navigator.sendBeacon(c,"&post_res="):util_1.warn("[arms] navigator.sendBeacon not surported")},selfId="aokcdqn3ly@e629dabd48a9933",pushToQueue=function(a,b){var c,d,e;return"error"===b.t&&(c=a.$af[0])&&"error"===c.t&&b.msg===c.msg?(c.times++,void 0):("behavior"===b.t?(d=a.$af&&a.$af.length,d>0&&"behavior"===a.$af[d-1].t?(e=b.behavior||[],a.$af[d-1].behavior.concat(e)):a.$af.push(b)):a.$af.unshift(b),a.$ag(function(){a.$ah=util_1.delay(function(){a.$ai()},a.$af[0]&&"error"===a.$af[0].t?3e3:-1)}),!0)},Base=function(a){return this.ver="1.8.31",this._conf=util_1.ext({},Base.dftCon),this.$aj={},this.$af=[],this.$ak=[],this.sdkFlag=!0,this.hash=util_1.seq(),this.$al(),this.setConfig(a),this.rip=util_1.getRandIP(),this.record=999,this["EagleEye-TraceID"]=this.getTraceId()["EagleEye-TraceID"],this._common={},this},Base.dftCon={sample:1,pvSample:1,tag:"",imgUrl:"https://arms-retcode.aliyuncs.com/r.png?",region:null,ignore:{ignoreUrls:[],ignoreApis:[],ignoreErrors:[/^Script error\.?$/],ignoreResErrors:[]},release:void 0,environment:"prod"},Base.prototype={constructor:Base,$ag:function(a){return a()},$am:function(){var a=this._conf.page;return util_1.$a3(a,[],a+"")},setPage:function(){},setConfig:function(a){a&&"object"==typeof a&&(util_1.$a6(a),a=this.$an(a),this._conf=util_1.ext({},this._conf,a))},$an:function(a){var d,b=a.region,c=a.imgUrl;return b?(d=util_1.regionMap[b],a.imgUrl=d||util_1.defaultImgUrl,a):(c&&(a.imgUrl=c),a)},$ao:function(a){var b,c,d;if(this.getConfig("debug"))return!0;b=util_1.regionMap,c=!1;for(d in b)if(b[d]===a){c=!0;break}return!c&&util_1.warn("[retcode] invalid url: "+a),c},$ap:function(){},$aq:function(a){sendBeacon(a,this.getConfig("imgUrl"))},$ar:function(){},$as:function(){return{}},setCommonInfo:function(a){a&&"object"==typeof a&&(this._common=util_1.ext({},this._common,a))},$al:function(){this.pageview=util_1.uu(),this.sBegin=Date.now()},$at:function(){var a,b,c;if(this.username)return this.username;if(a=this._conf,b=a&&a.setUsername,"function"==typeof b)try{c=b(),"string"==typeof c&&(c=c.substr(0,40),this.username=c)}catch(d){util_1.warn("[arms] setUsername fail",d)}return this.username},getTraceId:function(){var a=this.rip,b=Date.now(),c=util_1.getSortNum(this.record),d=a+b+c+util_1.getRandNum(this._conf.pid);return this["EagleEye-TraceID"]=d,this.record=c,{"EagleEye-TraceID":d}},getUberTraceId:function(a){var b=this.rip,c=Date.now(),d=util_1.getSortNum(this.record),e=util_1.getRandNum(this._conf.pid),f=b+c+d+util_1.getNum(2)+e,g=f.substring(0,16);return a=a?"1":"0",{"uber-trace-id":f+":"+g+":0:"+a,traceId:f}},getPageviewId:function(){return{"EagleEye-SessionID":this.pageview}},getConfig:function(a){return a?this._conf[a]:util_1.ext({},this._conf)},$au:function(a){return 1===a||("boolean"==typeof this.$aj[a]?this.$aj[a]:(this.$aj[a]=util_1.pick(a),this.$aj[a]))},$ai:function(a){var b,c;for(clearTimeout(this.$ah),this.$ah=null,c=this._conf&&"function"==typeof this._conf.sendRequest;b=this.$af.pop();)"res"===b.t?this.$ar(b,"res"):"error"===b.t?this.$ar(b,"err"):"api"===b.t?this.$ar(b,"apiSnapshot"):"behavior"===b.t?this.$ar(b,"behavior"):"health"===b.t&&!c&&window&&window.navigator&&"function"==typeof window.navigator.sendBeacon?this.$aq(b):this.$ap(b);return a&&this.$av(),this},$av:function(){var a;for(clearTimeout(this.$aw),this.$aw=null;a=this.$ak.pop();)this.$ar(a,"err");return this},_lg:function(a,b,c,d){var l,e=this._conf,f=this.$am(),g=e.ignore||{},h=g.ignoreErrors,i=g.ignoreResErrors,j=g.ignoreUrls,k=g.ignoreApis;return this._isRobot?this:util_1.$a5(f,j)||util_1.$a5(util_1.decode(f),j)?this:"error"===a&&(util_1.$a5(b.msg,h)||util_1.$a5(util_1.decode(b.msg),h))?this:"resourceError"===a&&(util_1.$a5(b.src,i)||util_1.$a5(util_1.decode(b.src),i))?this:"api"===a&&(util_1.$a5(b.api,k)||util_1.$a5(util_1.decode(b.api),k))?this:this.$ao(e.imgUrl)?b&&!e.disabled&&e.pid?0===d?this:(l=b.dl,delete b.dl,b=util_1.ext({t:a,times:1,page:f,tag:e.tag||"",release:e.release||"",environment:e.environment,begin:Date.now(),c1:e.c1,c2:e.c2,c3:e.c3},b,this.$as(),this._common,{pid:e.pid,_v:this.ver,pv_id:this.pageview,username:this.$at(),sampling:c||1,dl:l,z:util_1.seq()}),1===d?pushToQueue(this,b):c&&!this.$au(c)?this:pushToQueue(this,b)):this:this},_self:function(a,b,c){var f,d=this,e=d._conf;if("error"!==a)return d;if(!d.$ao(e.imgUrl))return d;if(!b||e.disabled||!e.pid||!selfId)return d;if(c&&!d.$au(c))return d;if(b=util_1.ext({t:a,times:1,page:util_1.selfErrPage,tag:e.pid,begin:Date.now()},b,{pid:selfId,_v:d.ver,sampling:c||1,z:util_1.seq()}),f=d.$ak[0]){f.times++;try{f.err&&b.err&&f.err.msg_raw&&b.err.msg_raw&&f.err.msg_raw.split("&").indexOf(b.err.msg_raw)<0&&f.err.msg_raw.length<1e3&&(f.err.msg_raw+="&"+b.err.msg_raw)}catch(g){}}else d.$ak.unshift(b),d.$ag(function(){d.sdkFlag&&(d.sdkFlag=!1,d.$aw=util_1.delay(function(){d.$av()},1e4))})},custom:function(a,b){if(!a||"object"!=typeof a)return this;var c=!1,d={begin:Date.now()};return util_1.each(a,function(a,b){return!(c=b&&b.length<=20)&&util_1.warn("[retcode] invalid key: "+b),d["x-"+b]=a,c}),c?this._lg("custom",d,b||1):this}},base=Base,validApiKeys=["api","success","time","code","msg","trace","traceId","begin","pv_id","sid","seq","domain","flag"],parseStatData=function(a){var b=(a.key||"default").split("::");return b.length>1?util_1.ext(a,{group:b[0],key:b[1]}):util_1.ext(a,{group:"default_group",key:b[0]})},Reporter=function(a){base.call(this,a);var b;try{b="object"==typeof performance?performance.timing.fetchStart:Date.now()}catch(c){b=Date.now()}return this._startTime=b,this},Reporter.prototype=util_1.$a2(base.prototype),util_1.ext(base.dftCon,{startTime:null}),util_1.ext(Reporter.prototype,{constructor:Reporter,_super:base,sum:function(a,b,c){try{var d=util_1.$ae(a,b,1);return this._lg("sum",parseStatData(d),c)}catch(e){util_1.warn("[retcode] can not get parseStatData: "+e)}},avg:function(a,b,c){try{var d=util_1.$ae(a,b,0);return this._lg("avg",parseStatData(d),c)}catch(e){util_1.warn("[retcode] can not get parseStatData: "+e)}},percent:function(a,b,c,d){try{return this._lg("percent",parseStatData({key:a,subkey:b,val:c||0,begin:Date.now()}),d)}catch(e){util_1.warn("[retcode] can not get parseStatData: "+e)}},msg:function(a,b){return!a||a.length>180?void 0:this.custom({msg:a},b)},error:function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n;if(!a)return util_1.warn("[retcode] invalid param e: "+a),this;if(1===arguments.length?("string"==typeof a&&(a={message:a},b={}),"object"==typeof a&&(b=a=a.error||a)):("string"==typeof a&&(a={message:a}),"object"!=typeof b&&(b={})),c=a.name||"CustomError",d=a.message||"",e=a.stack||"",b=b||{},f="object"==typeof location&&"string"==typeof location.href&&location.href.substring(0,500)||"",util_1.$ac(d,b.filename))return g=/^Script error\.?$/,h=a.msg||a.message,util_1.$a5(h,g)||util_1.$a5(util_1.decode(h),g)?this:(i={msg:util_1.selfErrKey,err:{msg_raw:util_1.encode(a.msg||a.message)}},this._self("error",i,1));for(j={begin:Date.now(),cate:c,msg:d&&d.substring(0,1e3),stack:e&&e.substring(0,1e3),file:util_1.$aa(b.filename||""),line:b.lineno||"",col:b.colno||"",err:{msg_raw:util_1.encode(d),stack_raw:util_1.encode(e)},dl:f},k=["tag","c1","c2","c3"],l=0;l<k.length;l++)m=k[l],b[m]&&(j[m]=b[m]);return n=(this.getConfig("ignore")||{}).ignoreErrors,util_1.$a5(j.msg,n)||util_1.$a5(util_1.decode(j.msg),n)?this:(this.$az&&this.$az("error",j),this._lg("error",j,1))},behavior:function(a){if(a){var b="object"==typeof a&&a.behavior?a:{behavior:a};return this.$az&&this.$az("behavior",b),this._lg("behavior",b,1)}},api:function(a,b,c,d,e,f,g,h,i,j,k,l){var m,n;return a?(a="string"==typeof a?{api:a,success:b,time:c,code:d,msg:e,begin:f,traceId:g,pv_id:h,apiSnapshot:i,domain:j,flag:l}:util_1.sub(a,validApiKeys),util_1.$a7(a.api,!0)?(a.code=a.code||"",m=a.msg||"",m="string"==typeof m?m.substring(0,1e3):m,a.msg=m,a.success=a.success?1:0,a.time=+a.time,a.begin=a.begin,a.traceId=a.traceId||"",a.pv_id=a.pv_id||"",a.domain=a.domain||"",a.flag=a.flag,a.dl="object"==typeof location&&"string"==typeof location.href&&location.href.substring(0,500)||"",a.success?a.apiSnapshot&&delete a.apiSnapshot:a.apiSnapshot=i,k&&(a.traceOrigin=k),!a.api||isNaN(a.time)?(util_1.warn("[retcode] invalid time or api"),this):(n=(this.getConfig("ignore")||{}).ignoreApis,util_1.$a5(a.api,n)||util_1.$a5(util_1.decode(a.api),n)?this:(this.$az&&this.$az("api",a),this._lg("api",a,a.success&&this.getConfig("sample"),a.flag)))):this):(util_1.warn("[retcode] api is null"),this)},speed:function(a,b,c){var d=this,e=this.getConfig("startTime")||this._startTime;return/^s(\d|1[0])$/.test(a)?(b="number"!=typeof b?Date.now()-e:b>=e?b-e:b,d.$ax=d.$ax||{},d.$ax[a]=b,d.$ax.begin=e,clearTimeout(d.$ay),d.$ay=setTimeout(function(){c||(d.$ax.page=d.$am(!0)),d._lg("speed",d.$ax),d.$ax=null},5e3),d):(util_1.warn("[retcode] invalid point: "+a),d)},performance:function(a){var b,c,d,e;if(a&&"object"==typeof a&&!this.$b0){if(b={},c={},d=this.getConfig("autoSendPerf"),a.autoSend&&d)return c=util_1.ext(this.$b1||{},a),this.$b0=!0,this._lg("perf",c,this.getConfig("sample"));if(a.autoSend&&!d)return delete a.autoSend,this.$b1?(c=util_1.ext(this.$b1||{},a),this.$b0=!0,this._lg("perf",c,this.getConfig("sample"))):void(this.$b1=a);for(e in a)(/^t([1-9]|1[0])$/.test(e)||"ctti"===e||"cfpt"===e)&&(b[e]=a[e]);if(!0===a.autoSend||!d&&(d||this.$b1))return!0!==a.autoSend&&!1===d&&this.$b1?(b=util_1.ext(this.$b1||{},b),this.$b0=!0,this._lg("perf",b,this.getConfig("sample"))):void 0;this.$b1=util_1.ext(this.$b1||{},b)}},resource:function(a,b){var c,d,e,f,g;if(!a||!util_1.isPlainObject(a))return util_1.warn("[arms] invalid param data: "+a),this;c=Object.keys(a),d=["begin","dom","load","res","dl"],e=!1;for(f in d)if(c.indexOf(d[f])<0){e=!0;break}return e?(util_1.warn("[arms] lack param data: "+a),this):(g={begin:a.begin||Date.now(),dom:a.dom||"",load:a.load||"",res:util_1.isArray(a.res)?JSON.stringify(a.res):JSON.stringify([]),dl:a.dl||""},this._lg("res",g,b))},event:function(a,b){var c,d,e;if("object"==typeof a&&a&&a.key){c={},d=["key","success","time","c1","c2","c3"];for(e in a)d.indexOf(e)>-1&&(c[e]=a[e]);c.success=!1===a.success?0:1,this._lg("event",c,b)}}}),Reporter._super=base,Reporter._root=base,base.Reporter=Reporter,reporter=Reporter,MiniProgramLogger=function(a){a&&a.pid||util_1.warn("[arms] pid is a required prop to instatiate MiniProgramLogger");var b=this;return reporter.call(b,a),b.appBegin=Date.now(),b._health={errcount:0,apisucc:0,apifail:0},b.DEFAUT_PAGE_PATH="[app]",b.isSendPerf=!1,b.$az=function(a,c){"error"===a?b._health.errcount++:"api"===a&&b._health[c.success?"apisucc":"apifail"]++},"function"==typeof b.$b2&&b.$b2(),b._conf&&b._conf.behavior&&"function"==typeof b.$b3&&b.$b3(),"function"==typeof b.$b4&&b.$b4(),this},MiniProgramLogger.prototype=util_1.$a2(reporter.prototype),util_1.ext(reporter._root.dftCon,{uid:null,setUsername:null,disableHook:!1,enableLinkTrace:!1,behavior:!1,enableConsole:!1,sendRequest:function(){},getCurrentPage:function(){}}),util_1.ext(MiniProgramLogger.prototype,{constructor:MiniProgramLogger,_super:reporter,setPage:function(a,b){var c=this,d=c.$b5;if(!1!==b){if(!a||a===d)return c;c.$b5=a,clearTimeout(c.$b6),c.$al(),c.$b6=setTimeout(function(){c.$b7()},10)}c._conf.page=a},$ag:function(a){a()},$ap:function(a,b){var c,d,e;if(this.getConfig("debug"))"undefined"!=typeof console&&console&&"function"==typeof console.log&&console.log("[arms] [DEBUG MODE] log data",a);else if(c=this.getConfig("imgUrl"),"object"==typeof a&&(a=util_1.serialize(a)),d=c+a,b&&(d+="&post_res="),e=this._conf.sendRequest,"function"==typeof e)try{e(d,b)}catch(f){util_1.warn("[arms] error in $ap",f)}},$ar:function(a,b){var c={};c[b]=a[b],delete a[b],this.$ap(a,c)},$am:function(){var b,c,a=this._conf.page;if("string"==typeof a&&a)return util_1.$a3(a,[],a+"");if(b=this._conf.getCurrentPage,"function"==typeof b)try{if(c=b(),c&&"string"==typeof c)return c}catch(d){util_1.warn("[arms] error in $am",d)}return"string"==typeof b&&b?b:this.DEFAUT_PAGE_PATH},$b8:function(){this.setCommonInfo({sid:util_1.uu()})},setConfig:function(a){var b,c;a&&"object"==typeof a&&(util_1.$a6(a),a=this.$an(a),b=this._conf,this._conf=util_1.ext({},this._conf,a),c="disableHook",c in a&&b[c]!==a[c]&&(a[c]?"function"==typeof this.removeHook&&this.removeHook():"function"==typeof this.addHook&&this.addHook()))},appLaunch:function(){this.appBegin=Date.now()},pageShow:function(){var a=this;a.$al(),a.$b9(),clearTimeout(a.$b6),a.$ba(),a.$b6=setTimeout(function(){a.$b7()},50),a.pvPage=a.$am()},pageHide:function(){this.$ba()},addHook:function(){return this},removeHook:function(){return this},hookApp:function(a){var b=this,c={onLaunch:function(){var c=1===arguments.length?[arguments[0]]:Array.apply(null,arguments),d=a.onLaunch;try{b.appLaunch()}catch(e){util_1.warn("[arms] error in hookApp:onLaunch",e)}return"function"==typeof d?d.apply(this,c):void 0},onError:function(c){var d=1===arguments.length?[arguments[0]]:Array.apply(null,arguments),e=a.onError;try{b.error(c),b.getConfig("behavior")&&"function"==typeof b.reportBehavior&&b.reportBehavior()}catch(c){util_1.warn("[arms] error in hookApp:onError",c)}return"function"==typeof e?e.apply(this,d):void 0}};return util_1.ext({},a,c)},hookPage:function(a){var b=this,c={onShow:function(){var c=1===arguments.length?[arguments[0]]:Array.apply(null,arguments),d=a.onShow;try{b.pageShow()}catch(e){util_1.warn("[arms] error in hookPage:pageShow",e)}return"function"==typeof d?d.apply(this,c):void 0},onHide:function(){var c=1===arguments.length?[arguments[0]]:Array.apply(null,arguments),d=a.onHide;try{b.pageHide()}catch(e){util_1.warn("[arms] error in hookPage:onHide",e)}return"function"==typeof d?d.apply(this,c):void 0},onUnload:function(){var c=1===arguments.length?[arguments[0]]:Array.apply(null,arguments),d=a.onUnload;try{b.pageHide()}catch(e){util_1.warn("[arms] error in hookPage:onUnload",e)}return"function"==typeof d?d.apply(this,c):void 0}};return util_1.ext({},a,c)},$b2:function(){},$b4:function(){this.setCommonInfo({app:"mini_common",uid:this._conf.uid})},$b7:function(){var a=this;a.$ag(function(){a._lg("pv",{},a.getConfig("pvSample"))})},$b9:function(){var a=this;a.isSendPerf||(a.$ag(function(){var b={fpt:Date.now()-a.appBegin};a._lg("perf",b,a.getConfig("sample"))}),a.isSendPerf=!0)},$ba:function(){this.$bb(),this.$ax&&(this._lg("speed",this.$ax),this.$ax=null,clearTimeout(this.$ay)),this.$ai(!0)},$bb:function(){var a,b;this.pvPage&&(a=util_1.ext({},this._health),a.healthy=a.errcount>0?0:1,a.begin=Date.now(),b=a.begin-this.sBegin,a.page=this.pvPage,a.stay=b,this._lg("health",a,1),this._health={errcount:0,apisucc:0,apifail:0},this.pvPage=null)}}),singleton=null,generator=function(a){return singleton||(singleton=new MiniProgramLogger(a||{})),singleton},MiniProgramLogger.createExtraInstance=function(a){return a&&"object"==typeof a?(a.disableHook=!0,a.behavior=!1):a={disableHook:!0,behavior:!1},new MiniProgramLogger(a)},MiniProgramLogger.init=generator,MiniProgramLogger.singleton=generator,MiniProgramLogger._super=reporter,MiniProgramLogger._root=reporter._root,reporter.MiniProgramLogger=MiniProgramLogger,miniProgramLogger=MiniProgramLogger,hook=function(a){var b=util_1,c=null,d={};return b.ext(a.prototype,{addHook:function(){return this.isHookInstantiated?this:(function(){var e,f,g,a=this;if("undefined"!=typeof wx&&wx&&"function"==typeof wx.request){c=wx,e={request:function(c){var e,f,g,h,i,j,k,l,m,n,d=(new Date).getTime();c&&"object"==typeof c&&c[0]&&(g=c[0],h=b.$a9(g.url),i=g.success,j=g.fail,k=g&&g.header,k&&"object"==typeof k||(k={}),l={},a.getConfig("enableLinkTrace")&&(m=k["EagleEye-pAppName"],e=k["EagleEye-TraceID"],f=k["EagleEye-SessionID"],e||(e=a.getTraceId()["EagleEye-TraceID"],l["EagleEye-TraceID"]=e),f||(f=a.getPageviewId()["EagleEye-SessionID"],l["EagleEye-SessionID"]=f),m||(n=a.getConfig("pid"),l["EagleEye-pAppName"]=n)),g.success=function(){var j,g=(new Date).getTime();b.$a7(h,!0)&&(j=arguments&&arguments[0]&&arguments[0].statusCode||200,a.api({api:c[0].url,success:!0,time:g-d,code:j,begin:d,traceId:e,pv_id:f})),i&&i.apply(a,[].slice.call(arguments))},g.fail=function(){var i,k,g=(new Date).getTime();b.$a7(h,!0)&&(i="",arguments&&arguments[0]&&"object"==typeof arguments[0]&&(i=(i=JSON.stringify(arguments[0])).substring(0,1e3)),k=arguments&&arguments[0]&&arguments[0].statusCode||"FAILED",a.api({api:c[0].url,success:!1,time:g-d,code:k,msg:i,begin:d,traceId:e,pv_id:f})),j&&j.apply(a,[].slice.call(arguments))},g.header=b.ext({},k,l))}};for(f in wx)e[f]?(g=f.toString(),d[g]=function(){return e[g](arguments),c[g].apply(c,[].slice.call(arguments))}):d[f]=c[f];wx=d}}.call(this),this.isHookInstantiated=!0,this)},removeHook:function(){return this.isHookInstantiated?(function(){"undefined"!=typeof wx&&wx&&c&&(wx=c,c=null)}.call(this),this.isHookInstantiated=!1,this):this},$b2:function(){return this.$bc?this:(this.getConfig("disableHook")||this.addHook(),this.$bc=!0,this)}}),a},miniBehavior=function(a){var b=[],c=util_1.reWriteMethod,d={consoleBehavior:function(){var a,b,d,e,f;if(console&&(a=["debug","info","warn","log","error"],b=null,Function&&(b=Function.prototype.apply||Function.apply),"function"==typeof b))for(d=this,e=0;e<a.length;e++)f=a[e],"function"==typeof console[f]&&c(console,f,function(a){var c=f;return function(){var e,f,g,h;for(e=arguments.length,f=new Array(e),g=0;e>g;g++)f[g]=arguments[g];h={type:"console",data:{level:c,message:f}},d&&"function"==typeof d.addBehavior&&d.addBehavior(h),"function"==typeof a&&b.call(a,console,f)}})}};return util_1.ext(a.prototype,{addBehavior:function(a){var c,d,f,g,h;if(this.getConfig("behavior")&&a&&"object"==typeof a){c="",this._conf&&"function"==typeof this._conf.getCurrentPage&&(c=this._conf.getCurrentPage()),d=null;try{d=Date.now()}catch(e){return void util_1.warn("[arms] error in Date.now",e)}if(f={},g=a.data||{},a.type)f=g;else{if("string"!=typeof g.name||"string"!=typeof g.message)return;f.name=g.name.substr(0,20),f.message=g.message.substr(0,200)}return f.message&&(f.message=util_1.encode(f.message)),h={type:a.type||"custom",data:f||{},timestamp:a.timestamp||d,page:a.page||c},b.push(h),b=b.slice(-100)}},getBehavior:function(){return b||[]},setBehavior:function(a){return a&&(b=a),b},reportBehavior:function(){var a=this;a.getConfig("behavior")&&(a.$bd&&(clearTimeout(a.$bd),a.$bd=void 0),a.$bd=setTimeout(function(){b&&b.length>0&&("function"==typeof a.behavior&&a.behavior(b),b=[])},0))},$b3:function(){}}),d},behavior=function(a,b){var c=null,d="",e=function(a){return function(){if(a&&c){var b=c,d=a+"timmer";b[d]&&(clearTimeout(b[d]),b[d]=void 0),b[d]=setTimeout(function(){"function"==typeof b.addBehavior&&b.addBehavior({type:"ui.default",data:{level:a}})},100)}}},f=miniBehavior(a)||{};util_1.ext(a.prototype,{$b3:function(){if(!this.hasInitBehavior&&!c&&void 0!==b&&b){try{this.getConfig("enableConsole")&&"function"==typeof f.consoleBehavior&&f.consoleBehavior.call(this),b&&("function"==typeof b.onKeyboardHeightChange&&b.onKeyboardHeightChange(e("KeyboardHeightChange")),"function"==typeof b.onPageNotFound&&b.onPageNotFound(e("PageNotFound")),"function"==typeof b.onAppShow&&b.onAppShow(e("AppShow")),"function"==typeof b.onAppHide&&b.onAppHide(e("AppHide"))),b&&"function"==typeof b.onAppRoute&&b.onAppRoute(function(a){var b={type:"navigation",data:{level:a&&a.openType||"unknown",from:d||"unknown",to:a&&a.path||"unknown"}};c&&"function"==typeof c.addBehavior&&c.addBehavior(b),d=a&&a.path||""}),b&&"function"==typeof b.onError&&b.onError(this.reportBehavior.bind(this))}catch(a){util_1.warn("[arms] error in initBehavior",a)}return c=this,this.hasInitBehavior=!0,this}}})},ARMS_STORAGE_MINIPROGRAM_WX_UID_KEY="ARMS_STORAGE_MINIPROGRAM_WX_UID_KEY",WXLogger=function(a){return miniProgramLogger.call(this,a),this.$be(),this},WXLogger.prototype=util_1.$a2(miniProgramLogger.prototype),util_1.ext(miniProgramLogger._root.dftCon,{sendRequest:function(a,b){if("undefined"!=typeof wx&&wx&&"function"==typeof wx.request)try{var c,d="GET";b&&(d="POST",c=JSON.stringify(b)),wx.request({url:a,method:d,data:c,fail:function(a){util_1.warn("[arms] sendRequest fail",a)}})}catch(e){util_1.warn("[arms] error in conf sendRequest",e)}},getCurrentPage:function(){if("function"==typeof getCurrentPages)try{var a=getCurrentPages()||[],b=a[a.length-1];return b&&b.route||null}catch(c){util_1.warn("[arms] error in conf getCurrentPage",c)}}}),util_1.ext(WXLogger.prototype,{constructor:WXLogger,_super:miniProgramLogger,$b4:function(){this.setCommonInfo({app:"mini_wx"}),this.$bf(),this.$bg(),this.$bh(),this.$b8()},$bh:function(){var a,b;if(this._conf&&this._conf.uid)this.setCommonInfo({uid:this._conf.uid});else if("undefined"!=typeof wx&&wx&&"function"==typeof wx.getStorageSync)try{a=wx.getStorageSync(ARMS_STORAGE_MINIPROGRAM_WX_UID_KEY),a&&"string"==typeof a?this.setCommonInfo({uid:a}):"function"==typeof wx.setStorageSync&&(b=util_1.uu(),wx.setStorageSync(ARMS_STORAGE_MINIPROGRAM_WX_UID_KEY,b),this.setCommonInfo({uid:b}))}catch(c){util_1.warn("[arms] error in $bh",c)}},$bf:function(){if("undefined"!=typeof wx&&wx&&"function"==typeof wx.getSystemInfoSync)try{var a=wx.getSystemInfoSync();"object"==typeof a&&this.setCommonInfo({sr:(a.screenWidth||0)+"x"+(a.screenHeight||0),vp:(a.windowWidth||0)+"x"+(a.windowHeight||0),dpr:a.pixelRatio,ul:a.language})}catch(b){util_1.warn("[arms] error in $bf",b)}},$bg:function(){var a=this;if("undefined"!=typeof wx&&wx&&"function"==typeof wx.getNetworkType)try{wx.getNetworkType({success:function(b){b&&"string"==typeof b.networkType&&a.setCommonInfo({ct:b.networkType})},fail:function(a){util_1.warn("[arms] $bg getNetworkType fail",a)}})}catch(b){util_1.warn("[arms] error in $bg",b)}},$be:function(){var a=this;if("object"==typeof wx&&wx&&"function"==typeof wx.getPerformance){a.$b9=function(){};try{wx.getPerformance().createObserver(function(b){var e,f,c=b.getEntries(),d={};if(Array.isArray(c)&&c.length>0)for(e=0;e<c.length;e++)switch(f=c[e],f.name){case"appLaunch":d.launch=f.duration;break;case"firstRender":d.fpt=f.duration}Object.keys(d).length>0&&a._lg("perf",d,a.getConfig("sample"))}).observe({entryTypes:["navigation","render"]})}catch(b){util_1.warn("[ARMS] $be error :",b)}}util_1.warn("[arms]: launch"),util_1.i()},hookApp:function(a){var b=this,c={onError:function(c){var f,g,h,d=1===arguments.length?[arguments[0]]:Array.apply(null,arguments),e=a.onError;try{c&&"object"==typeof c&&b.error(c),c&&"string"==typeof c&&(f=c.split("\n"),g="",h="",f.length>1&&(g=f[0]&&f[0].length<100?f[0]:f[0].substring(0,100),h=f[1]),b.error({name:g,message:h||c,stack:c}))}catch(c){util_1.warn("[arms] error in hookApp:onError",c)}return"function"==typeof e?e.apply(this,d):void 0},onLaunch:function(){var c=1===arguments.length?[arguments[0]]:Array.apply(null,arguments),d=a.onLaunch;try{b.appLaunch()}catch(e){util_1.warn("[arms] error in hookApp:onLaunch",e)}return"function"==typeof d?d.apply(this,c):void 0}};return util_1.ext({},a,c)}}),hook(WXLogger),"undefined"!=typeof wx&&wx&&behavior(WXLogger,wx),singleton$1=null,generator$1=function(a){return singleton$1||(singleton$1=new WXLogger(a||{})),singleton$1},WXLogger.createExtraInstance=function(a){return a&&"object"==typeof a?(a.disableHook=!0,a.behavior=!1):a={disableHook:!0,behavior:!1},new WXLogger(a)
},WXLogger.init=generator$1,WXLogger.singleton=generator$1,WXLogger._super=miniProgramLogger,WXLogger._root=miniProgramLogger._root,miniProgramLogger.WXLogger=WXLogger,clazz=WXLogger,module.exports=clazz;